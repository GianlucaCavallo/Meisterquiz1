<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Ramm‚Äôs dir rein! Das Meisterquiz</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      margin: 0;
      padding: 0;
      background: linear-gradient(135deg, #007bff, #00c6ff);
      color: #fff;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 20px;
    }
    .container {
      width: 100%;
      max-width: 500px;
    }
    h1 {
      text-align: center;
      font-size: 2rem;
      margin-bottom: 20px;
      font-weight: 800;
      text-shadow: 1px 2px 3px rgba(0,0,0,0.3);
    }
    .card {
      background: rgba(255,255,255,0.95);
      color: #333;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.15);
      margin-bottom: 20px;
      animation: fadeIn 0.3s ease;
    }
    select, textarea {
      width: 100%;
      padding: 12px;
      border-radius: 10px;
      border: 1px solid #ddd;
      font-size: 16px;
      margin-bottom: 15px;
    }
    button {
      width: 100%;
      padding: 15px;
      margin-top: 10px;
      border: none;
      border-radius: 12px;
      background: linear-gradient(135deg, #007bff, #00c6ff);
      color: #fff;
      font-size: 18px;
      font-weight: 600;
      transition: transform 0.1s ease, box-shadow 0.1s ease;
    }
    button:active {
      transform: scale(0.98);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    #frage {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 15px;
      white-space: pre-line;
    }
    .answer {
      margin-top: 15px;
      background: #f1f8ff;
      padding: 15px;
      border-radius: 10px;
      white-space: pre-line;
    }
    .hidden {
      display: none;
    }
    #punkteAnzeige {
      margin-top: 10px;
      font-weight: bold;
      text-align: center;
    }
    @keyframes fadeIn {
      from {opacity:0; transform: translateY(10px);}
      to {opacity:1; transform: translateY(0);}
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üî• Ramm‚Äôs dir rein! Das Meisterquiz üî•</h1>

    <!-- Oberkategorien -->
    <div class="card">
      <h3>W√§hle eine Oberkategorie:</h3>
      <select id="mainSelect">
        <option value="">-- bitte w√§hlen --</option>
        <option value="Seger">Seger-Fragen</option>
        <option value="Lindner">Lindner-Fragen</option>
        <option value="Wlasak">Wlasak-Fragen</option>
        <option value="Bernasch">Bernasch-Fragen</option>
        <option value="Zufall">üîÄ Zufallsfragen (alle)</option>
      </select>
      <button id="continueBtn">Weiter</button>
    </div>

    <!-- Unterkategorien -->
    <div class="card hidden" id="subCategory">
      <h3>W√§hle eine Unterkategorie:</h3>
      <select id="subSelect"></select>
      <button id="loadBtn">Fragen laden & Quiz starten</button>
    </div>

    <!-- Quizbereich -->
    <div class="card hidden" id="quizCard">
      <div id="frage"></div>
      <textarea id="userAnswer" placeholder="Deine Antwort..." rows="4"></textarea>
      <button id="answerBtn">Antwort anzeigen</button>
      <div class="answer hidden" id="richtigeAntwort"></div>
      <div id="bewertung" class="hidden">
        <button id="correctBtn">‚úÖ Richtig</button>
        <button id="wrongBtn">‚ùå Falsch</button>
      </div>
      <button id="nextBtn">‚û°Ô∏è N√§chste Frage</button>
      <p id="punkteAnzeige"></p>
    </div>
  </div>

  <script>
    const jsonMap = {
      "Seger": {
        "GEG": "seger_geg.json",
        "Brandschutz": "seger_brandschutz.json",
        "Bauphysik": "seger_bauphysik.json",
        "Blitzschutz": "seger_blitzschutz.json"
      },
      "Lindner": {
        "D√§mmung": "lindner_daemmung.json",
        "√úbung7": "lindner_uebung7.json",
        "√úbung8": "lindner_uebung8.json",
        "√úbung9": "lindner_uebung9.json",
        "√úbung10": "lindner_uebung10.json",
        "Metall 2": "lindner_metall2.json",
        "GEG-Test": "lindner_gegtest.json",
        "Puren": "lindner_puren.json",
        "Umweltschutz": "lindner_umweltschutz.json"
      },
      "Wlasak": {
        "PSA": "wlasak_psa.json",
        "Absturzsicherungen": "wlasak_absturz.json",
        "Sicherheitszeichen": "wlasak_sicherheitszeichen.json",
        "Allgemeine UVV": "wlasak_uvv_allgemein.json"
      },
      "Bernasch": {
        "Marketing & Betriebsf√ºhrung": "bernasch_marketing.json"
      }
    };

    let currentSet = [];
    let currentIndex = 0;
    let punkte = 0;
    let total = 0;

    document.getElementById('continueBtn').addEventListener('click', showSubcategories);
    document.getElementById('loadBtn').addEventListener('click', loadQuestions);
    document.getElementById('answerBtn').addEventListener('click', showAnswer);
    document.getElementById('correctBtn').addEventListener('click', () => markAnswer(true));
    document.getElementById('wrongBtn').addEventListener('click', () => markAnswer(false));
    document.getElementById('nextBtn').addEventListener('click', nextQuestion);

    function showSubcategories() {
      const main = document.getElementById('mainSelect').value;
      const subCat = document.getElementById('subCategory');
      const subSelect = document.getElementById('subSelect');
      subSelect.innerHTML = '';

      if(jsonMap[main]) {
        Object.keys(jsonMap[main]).forEach(sub => {
          subSelect.innerHTML += `<option value="${sub}">${sub}</option>`;
        });
        subCat.classList.remove('hidden');
      } else if(main === 'Zufall') {
        subCat.classList.add('hidden');
        loadAllQuestionsRandom();
      } else {
        subCat.classList.add('hidden');
      }
    }

    function loadQuestions() {
      const main = document.getElementById('mainSelect').value;
      const sub = document.getElementById('subSelect').value;
      const jsonFile = jsonMap[main][sub];

      fetch(jsonFile)
        .then(res => res.json())
        .then(data => {
          currentSet = shuffleArray(data);
          startQuiz();
        })
        .catch(err => alert("Fehler beim Laden der Fragen: " + err));
    }

    function loadAllQuestionsRandom() {
      let allFiles = [];
      Object.values(jsonMap).forEach(cat => {
        Object.values(cat).forEach(file => allFiles.push(file));
      });

      let promises = allFiles.map(file => fetch(file).then(r => r.json()));
      Promise.all(promises).then(allData => {
        let merged = [];
        allData.forEach(block => merged = merged.concat(block));
        currentSet = shuffleArray(merged);
        startQuiz();
      }).catch(err => alert("Fehler beim Laden der Zufallsfragen: " + err));
    }

    function startQuiz() {
      currentIndex = 0;
      punkte = 0;
      total = currentSet.length;
      document.getElementById('quizCard').classList.remove('hidden');
      nextQuestion();
    }

    function nextQuestion(){
      if(currentIndex >= currentSet.length){
        document.getElementById('frage').innerHTML = `üéâ Fertig! Dein Ergebnis: ${punkte}/${total}`;
        document.getElementById('userAnswer').classList.add('hidden');
        document.getElementById('bewertung').classList.add('hidden');
        document.getElementById('richtigeAntwort').classList.add('hidden');
        return;
      }

      let q = currentSet[currentIndex];
      document.getElementById('frage').innerText = `Frage ${currentIndex+1}/${total}: ${q.frage}`;
      document.getElementById('userAnswer').value='';
      document.getElementById('userAnswer').classList.remove('hidden');
      document.getElementById('richtigeAntwort').classList.add('hidden');
      document.getElementById('bewertung').classList.add('hidden');
      document.getElementById('punkteAnzeige').innerText = `Punkte: ${punkte}`;
    }

    function showAnswer(){
      let q = currentSet[currentIndex];
      document.getElementById('richtigeAntwort').innerText = `‚úÖ Richtige Antwort:\n${q.antwort}`;
      document.getElementById('richtigeAntwort').classList.remove('hidden');
      document.getElementById('bewertung').classList.remove('hidden');
    }

    function markAnswer(correct){
      if(correct) punkte++;
      currentIndex++;
      nextQuestion();
    }

    function shuffleArray(arr) {
      return arr.sort(() => Math.random() - 0.5);
    }
  </script>
</body>
</html>
